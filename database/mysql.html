<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>mysql 底层结构 | 言否</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/blog/image/favicon.png">
    <meta name="description" content="Enjoy myself,do what I want to do">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <link rel="preload" href="/blog/assets/css/0.styles.663d0149.css" as="style"><link rel="preload" href="/blog/assets/js/app.ba080af7.js" as="script"><link rel="preload" href="/blog/assets/js/3.6566da82.js" as="script"><link rel="preload" href="/blog/assets/js/1.5cc79ea6.js" as="script"><link rel="preload" href="/blog/assets/js/8.0462913b.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.609635cc.js"><link rel="prefetch" href="/blog/assets/js/11.f7d8cbc1.js"><link rel="prefetch" href="/blog/assets/js/12.3cd71ace.js"><link rel="prefetch" href="/blog/assets/js/13.d3d0a037.js"><link rel="prefetch" href="/blog/assets/js/14.741483e4.js"><link rel="prefetch" href="/blog/assets/js/15.785c9423.js"><link rel="prefetch" href="/blog/assets/js/16.d806bdf8.js"><link rel="prefetch" href="/blog/assets/js/17.555f1b0d.js"><link rel="prefetch" href="/blog/assets/js/18.8fcebbb9.js"><link rel="prefetch" href="/blog/assets/js/19.6587707f.js"><link rel="prefetch" href="/blog/assets/js/20.0955193e.js"><link rel="prefetch" href="/blog/assets/js/21.49e66b4a.js"><link rel="prefetch" href="/blog/assets/js/22.64542ff0.js"><link rel="prefetch" href="/blog/assets/js/4.e8cc4407.js"><link rel="prefetch" href="/blog/assets/js/5.3df1d429.js"><link rel="prefetch" href="/blog/assets/js/6.f1008f12.js"><link rel="prefetch" href="/blog/assets/js/7.36a7ff34.js"><link rel="prefetch" href="/blog/assets/js/9.07c0d383.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.663d0149.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-dad8a512><div data-v-dad8a512><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-dad8a512 data-v-dad8a512><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-64685f0e data-v-dad8a512 data-v-dad8a512><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>言否</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>sixone</span>
            
          <span data-v-64685f0e>2019 - </span>
          2020
        </a></span></div></div> <div class="hide" data-v-dad8a512><header class="navbar" data-v-dad8a512><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/image/logo.png" alt="言否" class="logo"> <span class="site-name">言否</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/categories/后端/" class="nav-link"><i class="iconfont undefined"></i>
  后端
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/JVM/" class="nav-link"><i class="iconfont undefined"></i>
  JVM
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/数据库/" class="nav-link"><i class="iconfont undefined"></i>
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/情感/" class="nav-link"><i class="iconfont undefined"></i>
  情感
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/前端/" class="nav-link"><i class="iconfont undefined"></i>
  前端
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/其它/" class="nav-link"><i class="iconfont undefined"></i>
  其它
</a></li></ul></div></div><div class="nav-item"><a href="/blog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/blog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      联系
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/liuyi6161" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://yanfou.gitee.io/blog/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-mayun"></i>
  码云
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://mp.weixin.qq.com/s/l0qGgBlxBv1n7Tc4WRb5IA" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-wechat"></i>
  散文
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-dad8a512></div> <aside class="sidebar" data-v-dad8a512><div class="personal-info-wrapper" data-v-ca798c94 data-v-dad8a512><img src="/blog/image/avatar.png" alt="author-avatar" class="personal-img" data-v-ca798c94> <h3 class="name" data-v-ca798c94>
    sixone
  </h3> <div class="num" data-v-ca798c94><div data-v-ca798c94><h3 data-v-ca798c94>12</h3> <h6 data-v-ca798c94>文章</h6></div> <div data-v-ca798c94><h3 data-v-ca798c94>12</h3> <h6 data-v-ca798c94>标签</h6></div></div> <hr data-v-ca798c94></div> <nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/categories/后端/" class="nav-link"><i class="iconfont undefined"></i>
  后端
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/JVM/" class="nav-link"><i class="iconfont undefined"></i>
  JVM
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/数据库/" class="nav-link"><i class="iconfont undefined"></i>
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/情感/" class="nav-link"><i class="iconfont undefined"></i>
  情感
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/前端/" class="nav-link"><i class="iconfont undefined"></i>
  前端
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/其它/" class="nav-link"><i class="iconfont undefined"></i>
  其它
</a></li></ul></div></div><div class="nav-item"><a href="/blog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/blog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      联系
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/liuyi6161" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://yanfou.gitee.io/blog/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-mayun"></i>
  码云
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://mp.weixin.qq.com/s/l0qGgBlxBv1n7Tc4WRb5IA" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-wechat"></i>
  散文
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-64685f0e data-v-dad8a512><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>mysql 底层结构</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>sixone</span>
            
          <span data-v-64685f0e>2019 - </span>
          2020
        </a></span></div></div> <div data-v-dad8a512><main class="page"><div class="page-title" style="display:none;"><h1>mysql 底层结构</h1> <hr> <div data-v-aa64b9d0><i class="iconfont reco-account" data-v-aa64b9d0><span data-v-aa64b9d0>61</span></i> <i class="iconfont reco-date" data-v-aa64b9d0><span data-v-aa64b9d0>2020-07-16</span></i> <i class="iconfont reco-eye" data-v-aa64b9d0><span id="/blog/database/mysql.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-aa64b9d0><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <i class="iconfont reco-tag tags" data-v-aa64b9d0><span class="tag-item" data-v-aa64b9d0>database</span><span class="tag-item" data-v-aa64b9d0>笔记</span></i></div></div> <div class="theme-reco-content content__default" style="display:none;"><h1 id="mysql底层结构分析-最终选择了什么数据结构作为索引？"><a href="#mysql底层结构分析-最终选择了什么数据结构作为索引？" class="header-anchor">#</a> Mysql底层结构分析(最终选择了什么数据结构作为索引？)</h1> <h2 id="索引是帮助mysql高效获取数据的排序的数据结构"><a href="#索引是帮助mysql高效获取数据的排序的数据结构" class="header-anchor">#</a> 索引是帮助Mysql高效获取数据的排序的数据结构</h2> <p>索引数据结构分类</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code>  演示地址：https://www.cs.usfca.edu/~galles/visualization/Algorithms.html
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><ul><li><p>二叉树</p></li> <li><p>红黑树</p></li> <li><p>Hash表</p></li> <li><p>B-Tree</p></li></ul></blockquote> <h2 id="二叉树"><a href="#二叉树" class="header-anchor">#</a> 二叉树</h2> <p>演示地址：https://www.cs.usfca.edu/~galles/visualization/BST.html</p> <h2 id="红黑树（弱平衡二叉树-）插入最大2次旋转，删除最大3次旋转"><a href="#红黑树（弱平衡二叉树-）插入最大2次旋转，删除最大3次旋转" class="header-anchor">#</a> 红黑树（弱平衡二叉树 ）插入最大2次旋转，删除最大3次旋转</h2> <p>演示地址：<code>https://www.cs.usfca.edu/~galles/visualization/RedBlack.html</code></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>1、节点是红色或黑色
2、根节点是黑色
3、所有叶子节点是黑色（叶子节点是NIL节点，为了性质5到叶子节点具有相同数目黑色节点）
4、从每个叶子到根的所有路径上不能有两个连续的红色节点
5、从任一节点到其叶子的所有路径包含相同数目黑色节点

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="hash表"><a href="#hash表" class="header-anchor">#</a> Hash表</h2> <p>经过hash运算可以快速的查找，但是无法进行范围查询。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>1、哈希表是把索引字段映射成对应的哈希码然后再存放在对应的位置，这样的话，如果我们要进行模糊查找的话，显然哈希表这种结构是不支持的，只能遍历这个表。而B+树则可以通过最左前缀原则快速找到对应的数据。

2、如果我们要进行范围查找，例如查找ID为100 ~ 400的人，哈希表同样不支持，只能遍历全表。

3、索引字段通过哈希映射成哈希码，如果很多字段都刚好映射到相同值的哈希码的话，那么形成的索引结构将会是一条很长的链表，这样的话，查找的时间就会大大增加。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="b-tree-多路平衡搜索树"><a href="#b-tree-多路平衡搜索树" class="header-anchor">#</a> B-Tree(多路平衡搜索树)</h2> <p><img src="/blog/assets/img/B-tree.b1316115.png" alt="image-20200625224338667"></p> <p>B树也无法进行很好的范围查找。</p> <h2 id="b-tree-b-tree变种-多叉平衡数"><a href="#b-tree-b-tree变种-多叉平衡数" class="header-anchor">#</a> B+Tree(B-Tree变种) 多叉平衡数</h2> <ul><li>非叶子节点不存储data，只存储索引（冗余），可以放更多的索引</li> <li>叶子节点包含所有索引字段</li> <li>叶子节点用指针连接，提高区间访问的性能</li> <li>根节点直接放入内存进行查找，进行比对。 2 次 I/O 即可查询完毕</li> <li>支持很好的范围查找，因为叶子节点有指针关联（双向指针）</li></ul> <p><img src="/blog/assets/img/B+Tree.a3fdd08a.png" alt="image-20200625225830301"></p> <div class="language- line-numbers-mode"><pre class="language-text"><code> 可以存放多少个非叶子节点： 
 16KB/14B = 16*1024/14 = 1170个
 叶子节点：假设加data 可以存放 1kb  16
 假设 h = 3  可以存放多少个索引 ：1170 * 1170 * 16 &gt; 2000万
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="mysql-节点大小设置为16kb"><a href="#mysql-节点大小设置为16kb" class="header-anchor">#</a> mysql 节点大小设置为16kb</h2> <p><img src="/blog/assets/img/msqlnodesize.75119729.png" alt="image-20200625225228036"></p> <h2 id="mysql-5-5-的默认配置文件和数据文件的存放路径"><a href="#mysql-5-5-的默认配置文件和数据文件的存放路径" class="header-anchor">#</a> mysql 5.5 的默认配置文件和数据文件的存放路径</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>my.ini：
C:\ProgramData\MySQL\MySQL Server 5.5
数据文件：
C:\ProgramData\MySQL\MySQL Server 5.5\data
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="myisam存储引擎"><a href="#myisam存储引擎" class="header-anchor">#</a> MyISAM存储引擎</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>myisam索引文件和数据文件分离的
frm：表结构；MYD：数据文件；MYI：索引文件
首先是 MyI（index索引） 存储索引进行查找，查到叶子节点存放的是地址，然后根据地址查询MYD（data数据）获取数据。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><blockquote><p><img src="/blog/assets/img/mylsam_data.bfd612b7.png" alt="image-20200626101336307"> <img src="/blog/assets/img/mylsam.7c04975d.png" alt="image-20200626101057873"></p></blockquote> <h2 id="innodb存储引擎"><a href="#innodb存储引擎" class="header-anchor">#</a> InnoDB存储引擎 :</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>innoDB索引文件和数据文件是在一起的
frm：表结构；ibd：索引文件和数据文件
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><ol><li><h3 id="表数据文件本身就是按b-tree组织的一个索引结构文件"><a href="#表数据文件本身就是按b-tree组织的一个索引结构文件" class="header-anchor">#</a> 表数据文件本身就是按B+ Tree组织的一个索引结构文件</h3></li> <li><h3 id="聚集索引：叶子节点包含了完整的数据记录"><a href="#聚集索引：叶子节点包含了完整的数据记录" class="header-anchor">#</a> 聚集索引：叶子节点包含了完整的数据记录</h3></li> <li><h3 id="为什么innodb表必须有主键，并且推荐使用整型的自增主键？"><a href="#为什么innodb表必须有主键，并且推荐使用整型的自增主键？" class="header-anchor">#</a> 为什么InnoDB表必须有主键，并且推荐使用整型的自增主键？</h3> <blockquote><p>对于这颗主键索引的树</p> <p><img src="/blog/assets/img/inno1.eaa78542.png" alt="img"></p> <p>如果我们插入 ID = 650 的一行数据，那么直接在最右边插入就可以了</p> <p><img src="/blog/assets/img/inno2.b5431c25.png" alt="img"></p> <p>但是如果插入的是 ID = 350 的一行数据，由于 B+ 树是有序的，那么需要将下面的叶子节点进行移动，腾出位置来插入 ID = 350 的数据，这样就会比较消耗时间，如果刚好 R4 所在的数据页已经满了，需要进行<strong>页分裂</strong>操作，这样会更加糟糕。</p> <p>但是，如果我们的主键是自增的，每次插入的 ID 都会比前面的大，那么我们每次只需要在后面插入就行， 不需要移动位置、分裂等操作，这样可以提高性能。也就是为什么建议使用主键自增的索引。</p> <p>推荐使用整型的自增主键因为索引查找会进行大量的索引数据比较大小，占用空间小，且维护树结构新增叶子节点比较方便,不会大量导致元素的分裂和树的平衡</p> <p>1、如果设置了主键，那么InnoDB会选择主键作为聚集索引、如果没有显式定义主键，则InnoDB会选择第一个不包含有NULL值的唯一索引作为主键索引、如果也没有这样的唯一索引，则InnoDB会选择内置6字节长的ROWID作为隐含的聚集索引(ROWID随着行记录的写入而主键递增)。</p> <p>2、如果表使用自增主键
那么每次插入新的记录，记录就会顺序添加到当前索引节点的后续位置，主键的顺序按照数据记录的插入顺序排列，自动有序。当一页写满，就会自动开辟一个新的页</p> <p>3、如果使用非自增主键（如果身份证号或学号等）
由于每次插入主键的值近似于随机，因此每次新纪录都要被插到现有索引页得中间某个位置，此时MySQL不得不为了将新记录插到合适位置而移动数据，甚至目标页面可能已经被回写到磁盘上而从缓存中清掉，此时又要从磁盘上读回来，这增加了很多开销，同时频繁的移动、分页操作造成了大量的碎片，得到了不够紧凑的索引结构，后续不得不通过OPTIMIZE TABLE来重建表并优化填充页面</p></blockquote></li> <li><h3 id="为什么非主键索引结构叶子节点存储的主键值？（一致性和节省存储空间）"><a href="#为什么非主键索引结构叶子节点存储的主键值？（一致性和节省存储空间）" class="header-anchor">#</a> 为什么非主键索引结构叶子节点存储的主键值？（一致性和节省存储空间）</h3> <blockquote><p>非主键索引结构叶子节点存储的是主键值，使主键索引复用性高，节省空间，保证了主键索引的一致性。</p> <p>减少了出现行移动或者数据页分裂时二级索引的维护工作（当数据需要更新的时候，二级索引不需要修改，只需要修改聚簇索引，一个表只能有一个聚簇索引，其他的都是二级索引，这样只需要修改聚簇索引就可以了，不需要重新构建二级索引）</p> <p>聚簇索引也称为主键索引，其索引树的叶子节点中存的是整行数据，表中行的物理顺序与键值的逻辑（索引）顺序相同。一个表只能包含一个聚集索引。因为索引（目录）只能按照一种方法进行排序。</p> <p>非聚簇索引（普通索引）的叶子节点内容是主键的值。在 InnoDB 里，非主键索引也被称为二级索引（secondary index）。</p> <ul><li>主键索引和非主键索引有什么区别？</li></ul> <p>例如对于下面这个表(其实就是上面的表中增加了一个k字段),且ID是主键。</p> <p><img src="/blog/assets/img/inno3.c8fdbcbb.png" alt="img">
主键索引和非主键索引的示意图如下：
<img src="/blog/assets/img/inno4.198a13a5.png" alt="img">其中R代表一整行的值。</p> <p>从图中不难看出，主键索引和非主键索引的区别是：非主键索引的叶子节点存放的是<strong>主键的值</strong>，而主键索引的叶子节点存放的是<strong>整行数据</strong>，其中非主键索引也被称为<strong>二级索引</strong>，而主键索引也被称为<strong>聚簇索引</strong>。</p> <p>根据这两种结构我们来进行下查询，看看他们在查询上有什么区别。</p> <p>1、如果查询语句是 select * from table where ID = 100,即主键查询的方式，则只需要搜索 ID 这棵 B+树。</p> <p>2、如果查询语句是 select * from table where k = 1，即非主键的查询方式，则先搜索k索引树，得到ID=100,再到ID索引树搜索一次，这个过程也被称为回表。</p></blockquote></li></ol></blockquote> <p><img src="/blog/assets/img/image-20200626104917337.d6661160.png" alt="image-20200626104917337"></p> <h2 id="联合索引"><a href="#联合索引" class="header-anchor">#</a> 联合索引 :</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>innoDB索引文件和数据文件是在一起的
frm：表结构；ibd：索引文件和数据文件
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>HashMap</p> <p>组合结构： 左边部分是数组，右边部分是链表或则是红黑树，当&lt;6的时候蜕化为链表，&gt;8的时候转换为红黑树</p> <p><img src="/blog/assets/img/hashmap.27027e24.png" alt="image-20200626150727952"></p></div> <footer class="page-edit" style="display:none;"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">7/16/2020, 9:42:35 AM</span></div></footer> <!----> <!----> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-40a3448a><li class="level-2" data-v-40a3448a><a href="/blog/database/mysql.html#索引是帮助mysql高效获取数据的排序的数据结构" class="sidebar-link" data-v-40a3448a>索引是帮助Mysql高效获取数据的排序的数据结构</a></li><li class="level-2" data-v-40a3448a><a href="/blog/database/mysql.html#二叉树" class="sidebar-link" data-v-40a3448a>二叉树</a></li><li class="level-2" data-v-40a3448a><a href="/blog/database/mysql.html#红黑树（弱平衡二叉树-）插入最大2次旋转，删除最大3次旋转" class="sidebar-link" data-v-40a3448a>红黑树（弱平衡二叉树 ）插入最大2次旋转，删除最大3次旋转</a></li><li class="level-2" data-v-40a3448a><a href="/blog/database/mysql.html#hash表" class="sidebar-link" data-v-40a3448a>Hash表</a></li><li class="level-2" data-v-40a3448a><a href="/blog/database/mysql.html#b-tree-多路平衡搜索树" class="sidebar-link" data-v-40a3448a>B-Tree(多路平衡搜索树)</a></li><li class="level-2" data-v-40a3448a><a href="/blog/database/mysql.html#b-tree-b-tree变种-多叉平衡数" class="sidebar-link" data-v-40a3448a>B+Tree(B-Tree变种) 多叉平衡数</a></li><li class="level-2" data-v-40a3448a><a href="/blog/database/mysql.html#mysql-节点大小设置为16kb" class="sidebar-link" data-v-40a3448a>mysql 节点大小设置为16kb</a></li><li class="level-2" data-v-40a3448a><a href="/blog/database/mysql.html#mysql-5-5-的默认配置文件和数据文件的存放路径" class="sidebar-link" data-v-40a3448a>mysql 5.5 的默认配置文件和数据文件的存放路径</a></li><li class="level-2" data-v-40a3448a><a href="/blog/database/mysql.html#myisam存储引擎" class="sidebar-link" data-v-40a3448a>MyISAM存储引擎</a></li><li class="level-2" data-v-40a3448a><a href="/blog/database/mysql.html#innodb存储引擎" class="sidebar-link" data-v-40a3448a>InnoDB存储引擎 :</a></li><li class="level-3" data-v-40a3448a><a href="/blog/database/mysql.html#表数据文件本身就是按b-tree组织的一个索引结构文件" class="sidebar-link" data-v-40a3448a>表数据文件本身就是按B+ Tree组织的一个索引结构文件</a></li><li class="level-3" data-v-40a3448a><a href="/blog/database/mysql.html#聚集索引：叶子节点包含了完整的数据记录" class="sidebar-link" data-v-40a3448a>聚集索引：叶子节点包含了完整的数据记录</a></li><li class="level-3" data-v-40a3448a><a href="/blog/database/mysql.html#为什么innodb表必须有主键，并且推荐使用整型的自增主键？" class="sidebar-link" data-v-40a3448a>为什么InnoDB表必须有主键，并且推荐使用整型的自增主键？</a></li><li class="level-3" data-v-40a3448a><a href="/blog/database/mysql.html#为什么非主键索引结构叶子节点存储的主键值？（一致性和节省存储空间）" class="sidebar-link" data-v-40a3448a>为什么非主键索引结构叶子节点存储的主键值？（一致性和节省存储空间）</a></li><li class="level-2" data-v-40a3448a><a href="/blog/database/mysql.html#联合索引" class="sidebar-link" data-v-40a3448a>联合索引 :</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-44bd5a18 data-v-44bd5a18><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-44bd5a18><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-44bd5a18></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-44bd5a18></path></svg></div><div class="kanbanniang" data-v-ea6fe186><div class="banniang-container" style="display:;" data-v-ea6fe186><div class="messageBox" style="position:fixed;right:110px;bottom:370px;display:none;" data-v-ea6fe186>
      欢迎来到 言否
    </div> <div class="operation" style="bottom:60px;right:80px;display:;" data-v-ea6fe186><i class="kbnfont kbn-ban-home ban-home" data-v-ea6fe186></i> <i class="kbnfont kbn-ban-message message" data-v-ea6fe186></i> <i class="kbnfont kbn-ban-close close" data-v-ea6fe186></i> <a target="_blank" href="https://vuepress-theme-reco.recoluan.com/views/plugins/kanbanniang.html" data-v-ea6fe186><i class="kbnfont kbn-ban-info info" data-v-ea6fe186></i></a> <i class="kbnfont kbn-ban-theme skin" style="display:none;" data-v-ea6fe186></i></div> <canvas id="banniang" width="200" height="470" class="live2d" style="position:fixed;right:110px;bottom:50px;opacity:0.9;" data-v-ea6fe186></canvas></div> <div class="showBanNiang" style="display:none;" data-v-ea6fe186>
    看板娘
  </div></div><div class="reco-bgm-panel" data-v-39f9e6e0><audio id="bgm" src="./music/gzxbz.mp3" data-v-39f9e6e0></audio> <div class="reco-float-box" style="bottom:200px;z-index:999999;display:none;" data-v-39f9e6e0 data-v-41bcba48 data-v-39f9e6e0><img src="http://p2.music.126.net/EeCOXlqwFfuY4vHsS0foKA==/109951163876806880.jpg?param=300x300" data-v-39f9e6e0></div> <div class="reco-bgm-box" style="left:10px;bottom:10px;z-index:999999;" data-v-39f9e6e0 data-v-41bcba48 data-v-39f9e6e0><div class="reco-bgm-cover" style="background-image:url(http://p2.music.126.net/EeCOXlqwFfuY4vHsS0foKA==/109951163876806880.jpg?param=300x300);" data-v-39f9e6e0><div class="mini-operation" style="display:none;" data-v-39f9e6e0><i class="reco-bgm reco-bgm-pause" style="display:none;" data-v-39f9e6e0></i> <i class="reco-bgm reco-bgm-play" style="display:none;" data-v-39f9e6e0></i></div> <div class="falut-message" style="display:none;" data-v-39f9e6e0>
          播放失败
        </div></div> <div class="reco-bgm-info" data-v-39f9e6e0 data-v-41bcba48 data-v-39f9e6e0><div class="info-box" data-v-39f9e6e0><i class="reco-bgm reco-bgm-music music" data-v-39f9e6e0></i>公子向北走</div> <div class="info-box" data-v-39f9e6e0><i class="reco-bgm reco-bgm-artist" data-v-39f9e6e0></i>李春花</div> <div class="reco-bgm-progress" data-v-39f9e6e0><div class="progress-bar" data-v-39f9e6e0><div class="bar" data-v-39f9e6e0></div></div></div> <div class="reco-bgm-operation" data-v-39f9e6e0><i class="reco-bgm reco-bgm-last last" data-v-39f9e6e0></i> <i class="reco-bgm reco-bgm-pause pause" style="display:none;" data-v-39f9e6e0></i> <i class="reco-bgm reco-bgm-play play" data-v-39f9e6e0></i> <i class="reco-bgm reco-bgm-next next" data-v-39f9e6e0></i> <i class="reco-bgm reco-bgm-volume1 volume" data-v-39f9e6e0></i> <i class="reco-bgm reco-bgm-mute mute" style="display:none;" data-v-39f9e6e0></i> <div class="volume-bar" data-v-39f9e6e0><div class="bar" data-v-39f9e6e0></div></div></div></div> <div class="reco-bgm-left-box" data-v-39f9e6e0 data-v-41bcba48 data-v-39f9e6e0><i class="reco-bgm reco-bgm-left" data-v-39f9e6e0></i></div></div></div></div></div>
    <script src="/blog/assets/js/app.ba080af7.js" defer></script><script src="/blog/assets/js/3.6566da82.js" defer></script><script src="/blog/assets/js/1.5cc79ea6.js" defer></script><script src="/blog/assets/js/8.0462913b.js" defer></script>
  </body>
</html>
